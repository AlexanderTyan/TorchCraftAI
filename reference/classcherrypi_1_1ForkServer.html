<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>TorchCraftAI: cherrypi::ForkServer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TorchCraftAI
   </div>
   <div id="projectbrief">A bot for machine learning research on StarCraft: Brood War</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacecherrypi.html">cherrypi</a></li><li class="navelem"><a class="el" href="classcherrypi_1_1ForkServer.html">ForkServer</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="classcherrypi_1_1ForkServer-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">cherrypi::ForkServer Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This class lets us fork when using MPI.  
 <a href="classcherrypi_1_1ForkServer.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="forkserver_8h_source.html">forkserver.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a3cc917688a07639b6f1d553743654393"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcherrypi_1_1ForkServer.html#a3cc917688a07639b6f1d553743654393">ForkServer</a> ()</td></tr>
<tr class="separator:a3cc917688a07639b6f1d553743654393"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63879c5a8195b11f83fa47937eb551c9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcherrypi_1_1ForkServer.html#a63879c5a8195b11f83fa47937eb551c9">~ForkServer</a> ()</td></tr>
<tr class="separator:a63879c5a8195b11f83fa47937eb551c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02c20470b2e9692e03110dbad24b79bb"><td class="memItemLeft" align="right" valign="top">std::tuple&lt; int, int, int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcherrypi_1_1ForkServer.html#a02c20470b2e9692e03110dbad24b79bb">execute</a> (std::vector&lt; std::string &gt; const &amp;command, std::vector&lt; <a class="el" href="structcherrypi_1_1EnvVar.html">EnvVar</a> &gt; const &amp;env)</td></tr>
<tr class="memdesc:a02c20470b2e9692e03110dbad24b79bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Execute command with environment.  <a href="#a02c20470b2e9692e03110dbad24b79bb">More...</a><br /></td></tr>
<tr class="separator:a02c20470b2e9692e03110dbad24b79bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a815d603180b9d2dc1b913148352927f5"><td class="memTemplParams" colspan="2">template&lt;typename F , typename... Args&gt; </td></tr>
<tr class="memitem:a815d603180b9d2dc1b913148352927f5"><td class="memTemplItemLeft" align="right" valign="top">int&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classcherrypi_1_1ForkServer.html#a815d603180b9d2dc1b913148352927f5">fork</a> (F &amp;&amp;f, Args &amp;&amp;...args)</td></tr>
<tr class="memdesc:a815d603180b9d2dc1b913148352927f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">fork and call f with the specified arguments.  <a href="#a815d603180b9d2dc1b913148352927f5">More...</a><br /></td></tr>
<tr class="separator:a815d603180b9d2dc1b913148352927f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86377e2cc3988ea08611f7b5fb69e617"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcherrypi_1_1ForkServer.html#a86377e2cc3988ea08611f7b5fb69e617">waitpid</a> (int pid)</td></tr>
<tr class="separator:a86377e2cc3988ea08611f7b5fb69e617"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:ae45b16a5c62b38326b068029639a005a"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classcherrypi_1_1ForkServer.html">ForkServer</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcherrypi_1_1ForkServer.html#ae45b16a5c62b38326b068029639a005a">instance</a> ()</td></tr>
<tr class="separator:ae45b16a5c62b38326b068029639a005a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb34753c6186a939cdd1cef0e4803bdf"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcherrypi_1_1ForkServer.html#abb34753c6186a939cdd1cef0e4803bdf">startForkServer</a> ()</td></tr>
<tr class="separator:abb34753c6186a939cdd1cef0e4803bdf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad63f747e40a88cd03856d87f4895c1a0"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcherrypi_1_1ForkServer.html#ad63f747e40a88cd03856d87f4895c1a0">endForkServer</a> ()</td></tr>
<tr class="separator:ad63f747e40a88cd03856d87f4895c1a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This class lets us fork when using MPI. </p>
<p>You must call <a class="el" href="classcherrypi_1_1ForkServer.html#abb34753c6186a939cdd1cef0e4803bdf">ForkServer::startForkServer()</a> before mpi/gloo is initialized, and before any threads are created. The best place to call it is in main, after parsing command line arguments, and before <a class="el" href="namespacecherrypi.html#aee1297a8ebc84d3a4ccb5faa4efb3a5f">cherrypi::init()</a>. Example usage:</p>
<p><a class="el" href="classcherrypi_1_1ForkServer.html#abb34753c6186a939cdd1cef0e4803bdf">ForkServer::startForkServer()</a>; int pid = <a class="el" href="classcherrypi_1_1ForkServer.html#ae45b16a5c62b38326b068029639a005a">ForkServer::instance()</a>.fork([](std::string str) { VLOG(0) &lt;&lt; "This is a new process with message: " &lt;&lt; str; }, std::string("hello world")); <a class="el" href="classcherrypi_1_1ForkServer.html#ae45b16a5c62b38326b068029639a005a">ForkServer::instance()</a>.waitpid(pid); </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a3cc917688a07639b6f1d553743654393"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cherrypi::ForkServer::ForkServer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a63879c5a8195b11f83fa47937eb551c9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cherrypi::ForkServer::~ForkServer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="ad63f747e40a88cd03856d87f4895c1a0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void cherrypi::ForkServer::endForkServer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a02c20470b2e9692e03110dbad24b79bb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::tuple&lt; int, int, int &gt; cherrypi::ForkServer::execute </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::string &gt; const &amp;&#160;</td>
          <td class="paramname"><em>command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="structcherrypi_1_1EnvVar.html">EnvVar</a> &gt; const &amp;&#160;</td>
          <td class="paramname"><em>env</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Execute command with environment. </p>
<p>returns rfd, wfd, pid, where rfd and wfd is the read and write descriptor to stdout of the new process. </p>

</div>
</div>
<a class="anchor" id="a815d603180b9d2dc1b913148352927f5"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename F , typename... Args&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int cherrypi::ForkServer::fork </td>
          <td>(</td>
          <td class="paramtype">F &amp;&amp;&#160;</td>
          <td class="paramname"><em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Args &amp;&amp;...&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>fork and call f with the specified arguments. </p>
<p>f must be trivially copyable, args must be cereal serializable. You should not pass any pointers or references (either through argument or lambda capture), except to globals, since they will not be valid in the new process. There are no restrictions on what code can be executed in the function, but keep in mind that it runs in a new process with a single thread, as-if running from the point in the program where startForkServer was called. It is highly recommended to call waitpid at some point with the returned pid, because linux requires it in order to reap children and avoid a defunct process for every fork. returns pid </p>

</div>
</div>
<a class="anchor" id="ae45b16a5c62b38326b068029639a005a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classcherrypi_1_1ForkServer.html">ForkServer</a> &amp; cherrypi::ForkServer::instance </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="abb34753c6186a939cdd1cef0e4803bdf"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void cherrypi::ForkServer::startForkServer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a86377e2cc3988ea08611f7b5fb69e617"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cherrypi::ForkServer::waitpid </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pid</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/<a class="el" href="forkserver_8h_source.html">forkserver.h</a></li>
<li>src/forkserver.cpp</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Nov 28 2018 17:27:58 for TorchCraftAI by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
